---
/**
 * Multi-Step Lead Capture Form Component
 *
 * High-converting 4-step form based on BANT framework:
 * 1. Primary automation goal (low friction entry)
 * 2. Company size + industry
 * 3. Pain point + budget range
 * 4. Timeline + contact info
 *
 * Research shows 300% better conversion vs single-step forms
 */

interface Props {
  lang: 'fr' | 'en';
}

const { lang } = Astro.props;

// Translations
const translations = {
  fr: {
    step1: {
      title: "Quel est votre objectif principal ?",
      subtitle: "Choisissez l'option qui correspond le mieux",
      options: [
        { value: 'process', label: 'Automatiser des processus', icon: 'cog' },
        { value: 'customer', label: 'Améliorer le service client', icon: 'chat' },
        { value: 'marketing', label: 'Booster le marketing/ventes', icon: 'chart' },
        { value: 'other', label: 'Autre projet IA', icon: 'sparkle' }
      ]
    },
    step2: {
      title: "Parlez-nous de votre entreprise",
      sizeLabel: "Taille de l'équipe",
      sizeOptions: [
        { value: '1-10', label: '1-10 personnes' },
        { value: '11-50', label: '11-50 personnes' },
        { value: '51-500', label: '51-500 personnes' },
        { value: '500+', label: '500+ personnes' }
      ],
      industryLabel: "Secteur d'activité",
      industryOptions: [
        { value: 'saas', label: 'SaaS / Tech' },
        { value: 'ecommerce', label: 'E-commerce / Retail' },
        { value: 'services', label: 'Services / Conseil' },
        { value: 'manufacturing', label: 'Industrie / Production' },
        { value: 'healthcare', label: 'Santé / Pharma' },
        { value: 'finance', label: 'Finance / Assurance' },
        { value: 'other', label: 'Autre' }
      ]
    },
    step3: {
      title: "Vos besoins et budget",
      painLabel: "Principal défi actuel",
      painPlaceholder: "Ex: Trop de tâches manuelles répétitives...",
      budgetLabel: "Budget mensuel envisagé",
      budgetOptions: [
        { value: '500-2000', label: '500€ - 2 000€' },
        { value: '2000-10000', label: '2 000€ - 10 000€' },
        { value: '10000+', label: '10 000€+' },
        { value: 'unsure', label: 'Pas encore défini' }
      ]
    },
    step4: {
      title: "Dernière étape !",
      timelineLabel: "Quand souhaitez-vous démarrer ?",
      timelineOptions: [
        { value: 'asap', label: 'Dès que possible' },
        { value: '1-3months', label: 'Dans 1-3 mois' },
        { value: '3months+', label: 'Dans 3+ mois' },
        { value: 'exploring', label: "J'explore encore" }
      ],
      nameLabel: "Votre nom",
      namePlaceholder: "Jean Dupont",
      emailLabel: "Email professionnel",
      emailPlaceholder: "jean@entreprise.com",
      companyLabel: "Entreprise",
      companyPlaceholder: "Nom de votre entreprise"
    },
    navigation: {
      back: "Retour",
      next: "Continuer",
      submit: "Réserver ma consultation gratuite"
    },
    success: {
      title: "Merci !",
      message: "Nous avons bien reçu votre demande. Un expert vous contactera sous 24h pour planifier votre consultation gratuite.",
      cta: "Retour à l'accueil"
    },
    progress: "Étape {current} sur {total}"
  },
  en: {
    step1: {
      title: "What's your primary goal?",
      subtitle: "Choose the option that best fits",
      options: [
        { value: 'process', label: 'Automate processes', icon: 'cog' },
        { value: 'customer', label: 'Improve customer service', icon: 'chat' },
        { value: 'marketing', label: 'Boost marketing/sales', icon: 'chart' },
        { value: 'other', label: 'Other AI project', icon: 'sparkle' }
      ]
    },
    step2: {
      title: "Tell us about your company",
      sizeLabel: "Team size",
      sizeOptions: [
        { value: '1-10', label: '1-10 people' },
        { value: '11-50', label: '11-50 people' },
        { value: '51-500', label: '51-500 people' },
        { value: '500+', label: '500+ people' }
      ],
      industryLabel: "Industry",
      industryOptions: [
        { value: 'saas', label: 'SaaS / Tech' },
        { value: 'ecommerce', label: 'E-commerce / Retail' },
        { value: 'services', label: 'Services / Consulting' },
        { value: 'manufacturing', label: 'Manufacturing' },
        { value: 'healthcare', label: 'Healthcare / Pharma' },
        { value: 'finance', label: 'Finance / Insurance' },
        { value: 'other', label: 'Other' }
      ]
    },
    step3: {
      title: "Your needs and budget",
      painLabel: "Main challenge",
      painPlaceholder: "E.g., Too many repetitive manual tasks...",
      budgetLabel: "Monthly budget range",
      budgetOptions: [
        { value: '500-2000', label: '$500 - $2,000' },
        { value: '2000-10000', label: '$2,000 - $10,000' },
        { value: '10000+', label: '$10,000+' },
        { value: 'unsure', label: 'Not yet defined' }
      ]
    },
    step4: {
      title: "Final step!",
      timelineLabel: "When do you want to start?",
      timelineOptions: [
        { value: 'asap', label: 'As soon as possible' },
        { value: '1-3months', label: 'In 1-3 months' },
        { value: '3months+', label: 'In 3+ months' },
        { value: 'exploring', label: "I'm still exploring" }
      ],
      nameLabel: "Your name",
      namePlaceholder: "John Smith",
      emailLabel: "Professional email",
      emailPlaceholder: "john@company.com",
      companyLabel: "Company",
      companyPlaceholder: "Your company name"
    },
    navigation: {
      back: "Back",
      next: "Continue",
      submit: "Book my free consultation"
    },
    success: {
      title: "Thank you!",
      message: "We've received your request. An expert will contact you within 24 hours to schedule your free consultation.",
      cta: "Back to home"
    },
    progress: "Step {current} of {total}"
  }
};

const t = translations[lang];
---

<div
  x-data="multiStepForm()"
  class="max-w-2xl mx-auto"
>
  <!-- Progress Bar -->
  <div class="mb-8" x-show="!success">
    <div class="flex justify-between mb-2">
      <span class="text-sm text-muted" x-text="`${lang === 'fr' ? 'Étape' : 'Step'} ${currentStep} ${lang === 'fr' ? 'sur' : 'of'} 4`"></span>
      <span class="text-sm font-medium text-primary" x-text="`${Math.round((currentStep / 4) * 100)}%`"></span>
    </div>
    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
      <div
        class="h-full bg-gradient-to-r from-primary to-secondary transition-all duration-500 ease-out"
        :style="`width: ${(currentStep / 4) * 100}%`"
      ></div>
    </div>
  </div>

  <!-- Form Container -->
  <div class="bg-white rounded-2xl shadow-xl p-8 md:p-10" x-show="!success" x-transition>
    <!-- Step 1: Goal -->
    <div x-show="currentStep === 1" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-4" x-transition:enter-end="opacity-100 translate-x-0">
      <h2 class="text-2xl md:text-3xl font-heading font-bold text-text mb-2">{t.step1.title}</h2>
      <p class="text-muted mb-6">{t.step1.subtitle}</p>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {t.step1.options.map((option) => (
          <button
            type="button"
            x-on:click={`formData.goal = '${option.value}'; nextStep()`}
            x-bind:class={`formData.goal === '${option.value}' ? 'border-primary bg-primary/5 ring-2 ring-primary/20' : 'border-gray-200 hover:border-primary/50'`}
            class="flex flex-col items-center p-6 border-2 rounded-xl transition-all text-center cursor-pointer"
          >
            <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mb-3">
              {option.icon === 'cog' && (
                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              )}
              {option.icon === 'chat' && (
                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                </svg>
              )}
              {option.icon === 'chart' && (
                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
              )}
              {option.icon === 'sparkle' && (
                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                </svg>
              )}
            </div>
            <span class="font-medium text-text">{option.label}</span>
          </button>
        ))}
      </div>
    </div>

    <!-- Step 2: Company Info -->
    <div x-show="currentStep === 2" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-4" x-transition:enter-end="opacity-100 translate-x-0">
      <h2 class="text-2xl md:text-3xl font-heading font-bold text-text mb-6">{t.step2.title}</h2>

      <div class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-text mb-3">{t.step2.sizeLabel}</label>
          <div class="grid grid-cols-2 gap-3">
            {t.step2.sizeOptions.map((option) => (
              <button
                type="button"
                x-on:click={`formData.companySize = '${option.value}'`}
                x-bind:class={`formData.companySize === '${option.value}' ? 'border-primary bg-primary/5' : 'border-gray-200 hover:border-primary/50'`}
                class="px-4 py-3 border-2 rounded-lg transition-all text-sm font-medium"
              >
                {option.label}
              </button>
            ))}
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-3">{t.step2.industryLabel}</label>
          <select
            x-model="formData.industry"
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all text-text"
          >
            <option value="">-- {lang === 'fr' ? 'Sélectionnez' : 'Select'} --</option>
            {t.step2.industryOptions.map((option) => (
              <option value={option.value}>{option.label}</option>
            ))}
          </select>
        </div>
      </div>

      <!-- Navigation -->
      <div class="flex justify-between mt-8">
        <button
          type="button"
          @click="prevStep"
          class="px-6 py-3 text-muted hover:text-text transition-colors font-medium"
        >
          {t.navigation.back}
        </button>
        <button
          type="button"
          @click="nextStep"
          :disabled="!formData.companySize || !formData.industry"
          class="px-8 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {t.navigation.next}
        </button>
      </div>
    </div>

    <!-- Step 3: Pain & Budget -->
    <div x-show="currentStep === 3" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-4" x-transition:enter-end="opacity-100 translate-x-0">
      <h2 class="text-2xl md:text-3xl font-heading font-bold text-text mb-6">{t.step3.title}</h2>

      <div class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-text mb-2">{t.step3.painLabel}</label>
          <textarea
            x-model="formData.pain"
            rows="3"
            placeholder={t.step3.painPlaceholder}
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all text-text placeholder:text-subtle resize-none"
          ></textarea>
        </div>

        <div>
          <label class="block text-sm font-medium text-text mb-3">{t.step3.budgetLabel}</label>
          <div class="grid grid-cols-2 gap-3">
            {t.step3.budgetOptions.map((option) => (
              <button
                type="button"
                x-on:click={`formData.budget = '${option.value}'`}
                x-bind:class={`formData.budget === '${option.value}' ? 'border-primary bg-primary/5' : 'border-gray-200 hover:border-primary/50'`}
                class="px-4 py-3 border-2 rounded-lg transition-all text-sm font-medium"
              >
                {option.label}
              </button>
            ))}
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="flex justify-between mt-8">
        <button
          type="button"
          @click="prevStep"
          class="px-6 py-3 text-muted hover:text-text transition-colors font-medium"
        >
          {t.navigation.back}
        </button>
        <button
          type="button"
          @click="nextStep"
          :disabled="!formData.budget"
          class="px-8 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {t.navigation.next}
        </button>
      </div>
    </div>

    <!-- Step 4: Contact Info -->
    <div x-show="currentStep === 4" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-4" x-transition:enter-end="opacity-100 translate-x-0">
      <h2 class="text-2xl md:text-3xl font-heading font-bold text-text mb-6">{t.step4.title}</h2>

      <div class="space-y-5">
        <div>
          <label class="block text-sm font-medium text-text mb-3">{t.step4.timelineLabel}</label>
          <div class="grid grid-cols-2 gap-3">
            {t.step4.timelineOptions.map((option) => (
              <button
                type="button"
                x-on:click={`formData.timeline = '${option.value}'`}
                x-bind:class={`formData.timeline === '${option.value}' ? 'border-primary bg-primary/5' : 'border-gray-200 hover:border-primary/50'`}
                class="px-4 py-3 border-2 rounded-lg transition-all text-sm font-medium"
              >
                {option.label}
              </button>
            ))}
          </div>
        </div>

        <div>
          <label for="ms-name" class="block text-sm font-medium text-text mb-2">
            {t.step4.nameLabel} <span class="text-secondary">*</span>
          </label>
          <input
            type="text"
            id="ms-name"
            x-model="formData.name"
            required
            placeholder={t.step4.namePlaceholder}
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all text-text placeholder:text-subtle"
          />
        </div>

        <div>
          <label for="ms-email" class="block text-sm font-medium text-text mb-2">
            {t.step4.emailLabel} <span class="text-secondary">*</span>
          </label>
          <input
            type="email"
            id="ms-email"
            x-model="formData.email"
            required
            placeholder={t.step4.emailPlaceholder}
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all text-text placeholder:text-subtle"
          />
        </div>

        <div>
          <label for="ms-company" class="block text-sm font-medium text-text mb-2">
            {t.step4.companyLabel}
          </label>
          <input
            type="text"
            id="ms-company"
            x-model="formData.company"
            placeholder={t.step4.companyPlaceholder}
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all text-text placeholder:text-subtle"
          />
        </div>
      </div>

      <!-- Error Message -->
      <div
        x-show="error"
        x-transition
        class="mt-4 p-4 bg-red-50 border-2 border-red-200 rounded-lg"
      >
        <p class="text-red-600 text-center font-medium" x-text="errorMessage"></p>
      </div>

      <!-- Navigation -->
      <div class="flex justify-between mt-8">
        <button
          type="button"
          @click="prevStep"
          class="px-6 py-3 text-muted hover:text-text transition-colors font-medium"
        >
          {t.navigation.back}
        </button>
        <button
          type="button"
          @click="submitForm"
          :disabled="loading || !formData.name || !formData.email || !formData.timeline"
          class="px-8 py-4 bg-gradient-to-r from-primary to-secondary text-white font-bold rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
        >
          <span x-show="!loading">{t.navigation.submit}</span>
          <span x-show="loading" class="flex items-center gap-2">
            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>{lang === 'fr' ? 'Envoi...' : 'Sending...'}</span>
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Success State -->
  <div
    x-show="success"
    x-transition:enter="transition ease-out duration-500"
    x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100"
    class="bg-white rounded-2xl shadow-xl p-8 md:p-10 text-center"
  >
    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-green-100 flex items-center justify-center">
      <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
    </div>
    <h2 class="text-2xl md:text-3xl font-heading font-bold text-text mb-4">{t.success.title}</h2>
    <p class="text-muted mb-8 max-w-md mx-auto">{t.success.message}</p>
    <a
      href={lang === 'fr' ? '/' : '/en/'}
      class="inline-block px-8 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary/90 transition-all"
    >
      {t.success.cta}
    </a>
  </div>
</div>

<style>
  [x-cloak] {
    display: none !important;
  }
</style>
