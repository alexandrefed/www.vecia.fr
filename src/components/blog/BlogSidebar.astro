---
/**
 * BlogSidebar Component
 *
 * Conversion-focused sidebar for blog pages with:
 * - Lead magnet signup form (top priority)
 * - Popular articles list
 * - Quick tip callout box
 * - Social follow buttons
 *
 * Props:
 * - lang: Language code ('fr' | 'en')
 */

import type { Language } from '../../i18n/ui';
import { config } from '../../config';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;

// Placeholder translations (will be added to ui.ts in Part 7)
const t = {
  fr: {
    leadMagnet: {
      title: 'Ã‰valuation IA Gratuite',
      description: 'DÃ©couvrez 10+ heures d\'Ã©conomies par semaine',
      placeholder: 'votre@email.com',
      button: 'Obtenir Mon Audit',
      privacy: 'Pas de spam. DÃ©sinscription Ã  tout moment.'
    },
    popular: {
      title: 'Articles Populaires',
      readMore: 'Lire plus'
    },
    quickTip: {
      title: 'Astuce Rapide',
      content: 'Automatisez d\'abord les tÃ¢ches rÃ©pÃ©titives qui prennent 2+ heures par semaine pour un ROI immÃ©diat.'
    },
    follow: {
      title: 'Suivez-nous',
      linkedin: 'LinkedIn',
      twitter: 'Twitter / X'
    }
  },
  en: {
    leadMagnet: {
      title: 'Free AI Assessment',
      description: 'Discover 10+ hours of savings per week',
      placeholder: 'your@email.com',
      button: 'Get My Audit',
      privacy: 'No spam. Unsubscribe anytime.'
    },
    popular: {
      title: 'Popular Articles',
      readMore: 'Read more'
    },
    quickTip: {
      title: 'Quick Tip',
      content: 'Automate repetitive tasks taking 2+ hours per week first for immediate ROI.'
    },
    follow: {
      title: 'Follow Us',
      linkedin: 'LinkedIn',
      twitter: 'Twitter / X'
    }
  }
};

const translations = t[lang];

// Popular articles (static for now - can be dynamic later)
const popularArticles = [
  {
    fr: { title: '5 Signes que Votre Entreprise a Besoin d\'Automatisation', slug: 'automatisation-5-signes' },
    en: { title: '5 Signs Your Business Needs Automation', slug: 'automation-5-signs' }
  }
];
---

<aside class="space-y-8 sticky top-8">
  <!-- Lead Magnet Signup - TOP PRIORITY -->
  <div class="bg-gradient-to-br from-primary/10 via-secondary/10 to-accent1/10 p-6 rounded-2xl border border-primary/20 shadow-lg">
    <h3 class="text-xl font-heading font-bold text-text mb-2">
      {translations.leadMagnet.title}
    </h3>
    <p class="text-sm text-text/70 mb-4">
      {translations.leadMagnet.description}
    </p>

    <form
      x-data="{ email: '', submitted: false, loading: false }"
      @submit.prevent="
        loading = true;
        fetch('https://hooks.zapier.com/hooks/catch/YOUR_WEBHOOK_ID/', {
          method: 'POST',
          body: JSON.stringify({ email, source: 'blog-sidebar', lang: '{lang}' })
        })
        .then(() => { submitted = true; loading = false; })
        .catch(() => { loading = false; alert('Error. Please try again.'); });
      "
      class="space-y-3"
    >
      <input
        x-model="email"
        type="email"
        required
        placeholder={translations.leadMagnet.placeholder}
        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
        x-show="!submitted"
      />

      <button
        type="submit"
        x-show="!submitted"
        :disabled="loading"
        class="w-full bg-gradient-to-r from-primary to-secondary text-white font-semibold py-3 px-6 rounded-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <span x-show="!loading">{translations.leadMagnet.button}</span>
        <span x-show="loading" class="flex items-center justify-center">
          <svg class="animate-spin h-5 w-5 mr-2" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Loading...
        </span>
      </button>

      <div x-show="submitted" x-cloak class="text-center py-4 text-green-600 font-semibold">
        âœ… Merci ! VÃ©rifiez votre email.
      </div>

      <p class="text-xs text-text/60 text-center">
        ðŸ”’ {translations.leadMagnet.privacy}
      </p>
    </form>
  </div>

  <!-- Popular Articles -->
  <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
    <h3 class="text-lg font-heading font-bold text-text mb-4 flex items-center">
      <svg class="w-5 h-5 mr-2 text-primary" fill="currentColor" viewBox="0 0 20 20">
        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
      </svg>
      {translations.popular.title}
    </h3>

    <ul class="space-y-3">
      {popularArticles.map((article) => {
        const articleData = article[lang];
        const baseUrl = lang === 'fr' ? '/blog/' : '/en/blog/';

        return (
          <li>
            <a
              href={baseUrl + articleData.slug}
              class="group block p-3 rounded-lg hover:bg-accent3 transition-all duration-200"
            >
              <h4 class="text-sm font-semibold text-text group-hover:text-primary transition-colors line-clamp-2">
                {articleData.title}
              </h4>
              <span class="text-xs text-primary mt-1 inline-flex items-center group-hover:underline">
                {translations.popular.readMore}
                <svg class="w-3 h-3 ml-1 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </span>
            </a>
          </li>
        );
      })}
    </ul>
  </div>

  <!-- Quick Tip Box -->
  <div class="bg-gradient-to-br from-accent3 to-accent1/20 p-6 rounded-2xl border border-accent1/30">
    <div class="flex items-start">
      <div class="flex-shrink-0 w-10 h-10 bg-accent1 rounded-lg flex items-center justify-center text-white mr-3">
        ðŸ’¡
      </div>
      <div>
        <h3 class="text-sm font-heading font-bold text-text mb-2">
          {translations.quickTip.title}
        </h3>
        <p class="text-xs text-text/80 leading-relaxed">
          {translations.quickTip.content}
        </p>
      </div>
    </div>
  </div>

  <!-- Social Follow Buttons -->
  <div class="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
    <h3 class="text-lg font-heading font-bold text-text mb-4">
      {translations.follow.title}
    </h3>

    <div class="space-y-3">
      <!-- LinkedIn -->
      <a
        href={config.social.linkedin}
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-between w-full p-3 rounded-lg bg-[#0A66C2] text-white hover:bg-[#004182] transition-all duration-200 group"
      >
        <span class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
          </svg>
          {translations.follow.linkedin}
        </span>
        <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>

      <!-- Twitter / X -->
      <a
        href={config.social.twitter}
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-between w-full p-3 rounded-lg bg-black text-white hover:bg-gray-800 transition-all duration-200 group"
      >
        <span class="flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
          </svg>
          {translations.follow.twitter}
        </span>
        <svg class="w-4 h-4 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </div>
</aside>

<style>
  [x-cloak] {
    display: none !important;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
