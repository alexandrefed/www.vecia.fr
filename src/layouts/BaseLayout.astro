---
/**
 * BaseLayout - Production-Ready SEO Layout
 *
 * 2025 Best Practices Implementation:
 * - Comprehensive Open Graph + Twitter Card meta tags
 * - hreflang for multilingual SEO (FR/EN)
 * - JSON-LD structured data (Organization schema)
 * - Performance optimizations (preconnect, dns-prefetch)
 * - Mobile-first viewport configuration
 * - Canonical URLs for SEO
 */

import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import GoogleAnalytics from '../components/GoogleAnalytics.astro';
import CookieConsent from '../components/CookieConsent.astro';
import NewsletterPopup from '../components/NewsletterPopup.astro';
import StructuredData from '../components/seo/StructuredData.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  lang: 'fr' | 'en';
}

const { title, description, lang } = Astro.props;

// SEO: Canonical URL setup
const canonicalURL = new URL(Astro.url.pathname, Astro.site || 'https://vecia.com');

// SEO: Language alternates
const frURL = new URL('/', Astro.site || 'https://vecia.com');
const enURL = new URL('/en/', Astro.site || 'https://vecia.com');

// SEO: Open Graph image (using logo)
const ogImage = new URL('/vecia_logo_long_contour.png', Astro.site || 'https://vecia.com');

// JSON-LD Structured Data (Organization Schema)
const structuredData = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Vecia",
  "url": String(Astro.site || 'https://vecia.com'),
  "logo": String(ogImage),
  "description": description,
  "sameAs": [
    "https://www.linkedin.com/company/vecia"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "sales",
    "email": "contact@vecia.com"
  },
  "address": {
    "@type": "PostalAddress",
    "addressCountry": "FR"
  }
};
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content={Astro.generator}>

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description}>

    <!-- Canonical & hreflang (Multilingual SEO) -->
    <link rel="canonical" href={canonicalURL}>
    <link rel="alternate" hreflang="fr" href={frURL}>
    <link rel="alternate" hreflang="en" href={enURL}>
    <link rel="alternate" hreflang="x-default" href={frURL}>

    <!-- Sitemap (2025 SEO Best Practice) -->
    <link rel="sitemap" href="/sitemap-index.xml">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content={canonicalURL}>
    <meta property="og:title" content={title}>
    <meta property="og:description" content={description}>
    <meta property="og:image" content={ogImage}>
    <meta property="og:locale" content={lang === 'fr' ? 'fr_FR' : 'en_US'}>
    <meta property="og:locale:alternate" content={lang === 'fr' ? 'en_US' : 'fr_FR'}>
    <meta property="og:site_name" content="Vecia">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content={canonicalURL}>
    <meta name="twitter:title" content={title}>
    <meta name="twitter:description" content={description}>
    <meta name="twitter:image" content={ogImage}>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/vecia_favicon.png">

    <!-- Performance: Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">

    <!-- Hugeicons Icon Font -->
    <link rel="stylesheet" href="https://use.hugeicons.com/font/icons.css">

    <!-- Client-side scripts (Alpine.js + Pricing) - Properly bundled by Astro -->
    <script>
      import '../scripts/client.ts';
    </script>

    <!-- JSON-LD Structured Data: Organization -->
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

    <!-- JSON-LD Structured Data: WebSite with SearchAction -->
    <StructuredData
      type="website"
      data={{
        name: "Vecia",
        url: String(Astro.site || 'https://vecia.com'),
        description: description,
        searchUrl: "https://vecia.com/blog?q={search_term_string}"
      }}
    />

    <!-- Google Analytics 4 with Consent Mode V2 -->
    <GoogleAnalytics />

    <!-- Page-specific head content (e.g., breadcrumbs, article schemas) -->
    <slot name="head" />
  </head>

  <body class="font-body text-text bg-background">
    <!-- Navigation with language switcher -->
    <Navigation lang={lang} />

    <!-- Main content area -->
    <main>
      <slot />
    </main>

    <!-- Footer with legal links and social -->
    <Footer lang={lang} />

    <!-- Cookie Consent Banner (GDPR Compliance) -->
    <CookieConsent />

    <!-- Newsletter Popup (Skip on contact page) -->
    {Astro.url.pathname !== '/contact' && Astro.url.pathname !== '/en/contact' && (
      <NewsletterPopup />
    )}
  </body>
</html>
